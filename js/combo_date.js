function ComboDate(k){this.error="";this.base_id=k;this.base=document.getElementById(this.base_id);this.base_year=document.getElementById(this.base_id+"_year");this.base_month=document.getElementById(this.base_id+"_month");this.base_day=document.getElementById(this.base_id+"_day");this.getValueString=function(){return this.base_year.value+"-"+(1==this.base_month.value.length?"0":"")+this.base_month.value+"-"+(1==this.base_day.value.length?"0":"")+this.base_day.value};this.getValue=function(){return new Date(this.getValueString())};
this.setValue=function(a){this.base_year.value=a.getFullYear();this.base_month.value=a.getMonth()+1;this.base_day.value=a.getDate()};this.setError=function(a){this.error=a?this.base_id+": "+a:""};this.getError=function(){return this.error};this.isValid=function(){var a=this.getValue();if(isNaN(a.getTime()))return this.setError("Not a valid data"),!1;var b=this.getMax();if(void 0!==b&&!isNaN(b)&&a>b)return this.setError("Unacceptable date: too late."),!1;b=this.getMin();if(void 0!==b&&!isNaN(b)&&a<
b)return this.setError("Unacceptable date: too early."),!1;this.setError("");return!0};this.getMax=function(){var a=void 0!==this.base.dataset.max?this.base.dataset.max:this.base.getAttribute("max"),b;void 0!==a&&(b=new Date(a),isNaN(b)&&console.error(this.base.attr.id,"Max date is not valid.",b));return b};this.getMin=function(){var a=void 0!==this.base.dataset.min?this.base.dataset.min:this.base.getAttribute("min"),b;void 0!==a&&(b=new Date(a),isNaN(b)&&console.error(this.base.attr.id,"Min date is not valid.",
b));return b};var h=function(a){a.parentNode.removeChild(a)};this.resetDays=function(a,b,c){for(var d=['<option value="">&nbsp;</option>'],e=a.base_day.value,f=1;31>=f;f++)d.push('<option value="'+f+'"> '+f+"</option>");a.base_day.innerHTML=d.join("");a.base_day.value=e;if(void 0!==b&&!isNaN(b)&&void 0!==c&&!isNaN(c)){d=[];for(e=31;e>a.daysInMonth(b,c);e--)d.push('option[value="'+e+'"]');0<d.length&&Array.prototype.forEach.call(a.base_day.querySelectorAll(d.join(", ")),h)}};this.daysInMonth=function(a,
b){return(new Date(b,a,0)).getDate()};this.on_month_change=function(){var a=this;return function(){var b=parseInt(a.base_year.value),c=parseInt(a.base_month.value);a.resetDays(a,c,b);if(!isNaN(b)&&!isNaN(c)){var d=[],e=a.getMin(),f=a.getMax();if(void 0!==e&&!isNaN(e)&&c==e.getMonth()+1)for(var g=1;g<e.getDate();g++)d.push('option[value="'+g+'"]');b=(new Date(b,c,0)).getDate();void 0===f||isNaN(f)||c!=f.getMonth()+1||(b=Math.min(b,f.getDate()));for(c=31;c>b;c--)d.push('option[value="'+c+'"]');d.length&&
Array.prototype.forEach.call(a.base_day.querySelectorAll(d.join(",")),h)}void 0===a.base_day.querySelector('option[value="'+a.base_day.value+'"]')&&(a.base_day.value="");a.trigger()}};this.trigger=function(){if(void 0!==this.base)if("createEvent"in document){var a=document.createEvent("HTMLEvents");a.initEvent("change",!1,!0);this.base.dispatchEvent(a)}else this.base.fireEvent("onchange")};this.init=function(){this.resetDays(this);this.base_year.onchange=this.on_month_change();this.base_month.onchange=
this.on_month_change();this.base_day.onchange=function(a){return function(){a.trigger()}}(this)};this.init();return this};
